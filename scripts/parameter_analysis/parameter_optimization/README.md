# Parameter Optimization Tool

This tool finds the optimal parameters for a given scrimmage mission. It uses a function approximator to iteratively learn the utility of a mission given some parameters. A key feature is the ability to intelligently choose the next parameters to simulate, balancing exploration and exploitation of the state space in order to converge to optimal parameters.

First it creates a robust list of parameter samples to simulate in scrimmage in order to explore the parameter space. After collecting the utility output of each of these parameter samples, it then chooses a new parameter sample to try next in order to learn the most about the function, while also trying to find the argmax i.e. the best parameters for the mission. After completing the user-defined number of iterations, it will output the argmax and expected value of the mission.

## Getting Started

### Install Dependencies

In addition to scrimmage, install these python modules. 

    pip install bayesian-optimization
    pip install Mako

### Templatize the targeted mission file.

After choosing the scrimmage mission file, you need to decide the parameters of the mission that you want optimized. In your mission file, insert environment variable notation, e.g. ${example}, for the chosen parameters. For example:

    <autonomy order="2" 
    weight_priority="${w_pr}" weight_pk="${w_pk}"
    weight_dist=*${w_dist}"    dist_decay="${w_dist_decay}"> AuctionPlugin
    </autonomy>

In the above example, parameters *w_pr*, *w_pk*, *w_dist*, and *w_dist_decay* will be optimized by this tool. Keep in mind the more parameters you choose, the more difficult the analysis.

### Add Utility Metric to mission

In order to optimize the mission, this tool needs to map parameters to some Utility (value) of the mission. To do this, create a scrimmage metric plugin (or add to an existing one) that will create a column in the summary.csv for the utility of the mission- a single float value that represents the value of the mission results.

*Note: An option is to add multiple utility columns, this way you can optimize a subset of the mission.*

### Configure settings.json

Define the **MissionFilePath** and **LogPath**

The **StateSpaceSampler** is used to create an initial exploratory sampling of the parameter space. Currently there are two methods supported: Latin Hypercube Sampling, and Grid Search. LHS will choose random uniform orthogonal parameter samples, providing a good initial exploration. Grid Search will create uniform samples for every permutation of parameter values given the ranges and number of samples.

**UtilityColumnName** is the column name in summary.csv containing the utility value of the mission, which will be the target output of the function.

The **FunctionApproximator** will be the method used to map inputs to outputs and estimate the argmax (best parameters) of the mission. Only Bayesian Optimization (Gaussian Process with prediction) is supported currently. 

**FunctionApproximatorParameters** is a list of parameters specific to the chosen FunctionApproximator.

**NumExploreSamples** is the number of samples generated by the StateSpaceSampler. If using Grid Search, this is how many times a specific parameter will be sampled (the total number of samples would then be NumExploreSamples^NumParameters).

**NumIterationsPerSample** is how many missions a specific parameter set should run. The average of the utility is used for the FunctionApproximator.

**NumExploitSamples** is the number of samples the FunctionApproximator will iterate to maximize the utility.
    
*Note: Bayesian Optimization's parameter "kappa" tunes the function to Explore vs Exploit when choosing the next sample to try. High exploration means the algorithm will choose a point that will help it learn the most about the function, whereas high exploitation will choose a point that will maximize the output with high confidence.* 
    
    kappa = 10 -> much exploration. kappa = 1 -> much exploitation

**Ranges** is the collection of ranges for parameters found in the mission file.


